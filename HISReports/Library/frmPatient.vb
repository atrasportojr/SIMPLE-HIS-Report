Imports System.IO
Imports System.Drawing.Imaging
Imports System.Windows
Imports System.Runtime.InteropServices
Imports Microsoft.VisualBasic
'Imports System.Windows.DependencyObject
'Imports WPF_Webcam
Imports System
Public Class frmPatient
    Inherits Windows.Forms.Form


#Region "Designer"
    Friend WithEvents picOutput As System.Windows.Forms.PictureBox
    Friend WithEvents tmrUpdate As System.Windows.Forms.Timer
    Friend WithEvents sBar As System.Windows.Forms.Label

#End Region

#Region "API/constant"
    Private Const WS_CHILD As Integer = &H40000000
    Private Const WS_VISIBLE As Integer = &H10000000
    Private Const SWP_NOMOVE As Short = &H2S
    Private Const SWP_NOZORDER As Short = &H4S
    Private Const WM_USER As Short = &H400S
    Private Const WM_CAP_DRIVER_CONNECT As Integer = WM_USER + 10
    Private Const WM_CAP_DRIVER_DISCONNECT As Integer = WM_USER + 11
    Private Const WM_CAP_SET_VIDEOFORMAT As Integer = WM_USER + 45
    Private Const WM_CAP_SET_PREVIEW As Integer = WM_USER + 50
    Private Const WM_CAP_SET_PREVIEWRATE As Integer = WM_USER + 52
    Private Const WM_CAP_GET_FRAME As Long = 1084
    Private Const WM_CAP_COPY As Long = 1054
    Private Const WM_CAP_START As Long = WM_USER
    Private Const WM_CAP_STOP As Long = (WM_CAP_START + 68)
    Private Const WM_CAP_SEQUENCE As Long = (WM_CAP_START + 62)
    Private Const WM_CAP_SET_SEQUENCE_SETUP As Long = (WM_CAP_START + 64)
    Private Const WM_CAP_FILE_SET_CAPTURE_FILEA As Long = (WM_CAP_START + 20)

    Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" (ByVal hwnd As Integer, ByVal wMsg As Integer, ByVal wParam As Short, ByVal lParam As String) As Integer
    Private Declare Function capCreateCaptureWindowA Lib "avicap32.dll" (ByVal lpszWindowName As String, ByVal dwStyle As Integer, ByVal x As Integer, ByVal y As Integer, ByVal nWidth As Integer, ByVal nHeight As Short, ByVal hWndParent As Integer, ByVal nID As Integer) As Integer
    Private Declare Function capGetDriverDescriptionA Lib "avicap32.dll" (ByVal wDriver As Short, ByVal lpszName As String, ByVal cbName As Integer, ByVal lpszVer As String, ByVal cbVer As Integer) As Boolean
    Private Declare Function BitBlt Lib "GDI32.DLL" (ByVal hdcDest As IntPtr, ByVal nXDest As Integer, ByVal nYDest As Integer, ByVal nWidth As Integer, ByVal nHeight As Integer, ByVal hdcSrc As IntPtr, ByVal nXSrc As Integer, ByVal nYSrc As Integer, ByVal dwRop As Int32) As Boolean

#End Region

#Region "Variables"
    Public hasBalance As Boolean
    Public balanceAmount As Double
    Dim erp As New ErrorProvider
    Public myCurrentFormStatus As enFormStatus
    Public patientid As Long
    Public HospitalNo As String
    Public isSave As Boolean
    Private mypatient As clsAdmission
    Public hospnolen As String
    Private SearchName As String
    Public mPhiHealthNo As String '------ PhilHealthNo
    Public vHospitalno As String
    Private imageName As String
    Dim imageName1 As String
    Dim dtUsers As New DataTable
    Dim _SqlConnection As New System.Data.SqlClient.SqlConnection()
    Dim hasImage As Boolean
    'Dim vReligion As String
    Dim vNationality As String
    Dim vBloodType As String
    Dim Exist As Boolean
    Dim mPatientName As String
    Dim dtpatient As New DataTable
    Private CamFrameRate As Integer = 15
    Private iDevice As String
    Private hHwnd As Integer
    Private lwndC As Integer
    Dim dlg As New OpenFileDialog
    Public vFilePath As String
    Private oldLastName As String
    Private oldFirstName As String
    Private oldMI As String
    Private gender As String
    Private cmbid As Integer
    Private provid As Integer
    Dim faddress As String
    Dim mLastName As String
    Dim mFName As String
    Dim tempMName As String
    Dim isValidName As Boolean = True

    Private vishospnounique As Integer
    Private vishospnoautogenerated As Integer

    Private vbarangayid As Long
    Private vmunicipalityid As Long
    Private vregionid As Long
    Private vprovinceid As Long
    Dim vsaved As Boolean = False
    Dim x As Integer = 0
    Dim temphospno As String
    Dim vpatphilhealthno As String

    Dim vphilhealthno As String
    Enum enFormStatus
        browsing = 0
        add = 1
        edit = 2
        view = 3
    End Enum

#End Region

#Region "Validation"
    Private Sub txtLName_KeyUp(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txtLName.Leave
        If myCurrentFormStatus = enFormStatus.edit And vsaved = True Then
            If mLastName <> Me.txtLName.Text Then
                Call isFieldValidName()
            Else
                SetErrorProvider(txtLName)
                isValidName = True
            End If
        ElseIf myCurrentFormStatus = enFormStatus.add And vsaved = True Then
            Call isFieldValidName()
        Else
            Exit Sub
        End If
    End Sub
    Private Sub txtFName_KeyUp(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txtFName.Leave
        If myCurrentFormStatus = enFormStatus.edit And vsaved = True Then
            If mFName <> Me.txtFName.Text Then
                Call isFieldValidName()
            Else
                SetErrorProvider(txtFName)
                isValidName = True
            End If
        ElseIf myCurrentFormStatus = enFormStatus.add And vsaved = True Then
            Call isFieldValidName()
        Else
            Exit Sub
        End If
    End Sub
    Private Sub txtMI_KeyUp(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txtMI.Leave
        If myCurrentFormStatus = enFormStatus.add And vsaved = True Then
            If Me.txtMI.Text <> "" Then
                x = 1
            End If
            Call isFieldValidName()
        ElseIf myCurrentFormStatus = enFormStatus.edit And vsaved = True Then
            If tempMName <> Me.txtMI.Text Or txtMI.Text = "" Then
                Call isFieldValidName()
            Else
                SetErrorProvider(txtMI)
            End If
        Else
            Exit Sub
        End If
    End Sub
    Private Sub txtPhilHealthNo_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txtPhilHealthNo.TextChanged
        If Me.chkisphilhealthmember.Checked = True And myCurrentFormStatus <> enFormStatus.browsing Then
            Call isFieldValidName()
        End If
    End Sub
    Private Sub txthospitalno_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txthospitalno.Enter
        Me.txthospitalno.Focus()
        Me.txthospitalno.SelectAll()
    End Sub
    Private Sub txthospitalno_kepup(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles txthospitalno.KeyUp
        hospnolen = txthospitalno.Text
        Call Split(hospnolen)
        Dim dt As DataTable = clsPatient.genericcls(19, hospnolen)
        Dim dts As DataTable = clsPatient.genericcls(23, hospnolen)
        If dts.Rows(0).Item("isexist") = 1 And vishospnounique = 0 And hospnolen <> "000000" Then
            SetErrorProvider(Me.txthospitalno)
            SetErrorProvider(Me.txthospitalno, "This Hospital No. is already in use by an active patient.")
            'isValidName = False
        ElseIf dt.Rows(0).Item("isexist") = 1 And vishospnounique = 1 Then
            Call isFieldValidName()
        Else
            SetErrorProvider(Me.txthospitalno)
        End If
    End Sub
    Private Function AllDataEntryFieldsAreValid() As Boolean
        Dim blnValid As Boolean = True
        If isFieldValidName() = False Then
            blnValid = False
            Return blnValid
            Exit Function
        End If
        Return blnValid
    End Function
    Private Sub ResetAllErrorProviders()
        SetErrorProvider(Me.txtFName)
        SetErrorProvider(Me.txtLName)
        SetErrorProvider(Me.txtMI)
        SetErrorProvider(Me.txthospitalno)
        SetErrorProvider(Me.txtPhilHealthNo)
    End Sub
    Private Sub SetErrorProvider(ByVal ctl As Control, Optional ByVal strErrorMessage As String = "")
        erp.SetError(ctl, strErrorMessage)
    End Sub
    Private Function ValidateAllFields() As Boolean
        If myCurrentFormStatus <> enFormStatus.browsing Then
            Dim isvalid As Boolean = True
            If isFieldValidName() = False Then
                isvalid = False
                isvalid = False
                isvalid = False
                isvalid = False
                isvalid = False
            End If
            Return isvalid
        End If
        Return True
    End Function
    Private Function isFieldValidName() As Boolean
        vsaved = True
        Dim dts As New DataTable
        Dim dtphilhealth As New DataTable
        Dim dtpatient As New Boolean

        If myCurrentFormStatus <> enFormStatus.browsing Then
            dtpatient = clsPatient.isPatientNameExist(x, Trim(txtLName.Text), Trim(txtFName.Text), Trim(Me.txtMI.Text), patientid)
            hospnolen = txthospitalno.Text
            Call Split(hospnolen)
            Dim dt As DataTable = clsPatient.genericcls(23, hospnolen)
            dts = clsPatient.genericcls(19, hospnolen)
            If myCurrentFormStatus = enFormStatus.browsing Then
                Return True
                Exit Function
            End If
            If (txtLName.Text) = "" And (txtFName.Text) = "" And (txtMI.Text) = "" And vsaved = True And txthospitalno.Focused = False Then
                SetErrorProvider(Me.txtLName, "This field is required.")
                SetErrorProvider(Me.txtFName, "This field is required.")
                SetErrorProvider(Me.txtMI, "This field is required.")
                isValidName = False
            ElseIf Me.txthospitalno.Text <> temphospno And txthospitalno.Enabled = True Then
                If (hospnolen) = "" And vsaved = True Then
                    SetErrorProvider(Me.txthospitalno, "This field is required.")
                    isValidName = False
                ElseIf myCurrentFormStatus <> enFormStatus.browsing Then
                    If dt.Rows(0).Item("isexist") = 1 And vishospnounique = 0 And hospnolen <> "000000" Then
                        SetErrorProvider(Me.txthospitalno)
                        SetErrorProvider(Me.txthospitalno, "This Hospital No. is already in use by an active patient.")
                        isValidName = False
                    ElseIf dts.Rows(0).Item("isexist") = 1 And vishospnounique = 1 Then
                        SetErrorProvider(Me.txthospitalno, "Hospital No. already exists.")
                        isValidName = False
                    ElseIf txthospitalno.Text = "" And vsaved = True Then
                        SetErrorProvider(Me.txthospitalno, "This field is required.")
                        isValidName = False
                    Else
                        SetErrorProvider(txthospitalno)
                        isValidName = True
                    End If
                Else
                    SetErrorProvider(txthospitalno)
                    isValidName = True
                End If
                If isValidName = False Then
                    Return False
                    Exit Function
                End If
            End If

            If vsaved = True Then
                SetErrorProvider(Me.txtLName)
                SetErrorProvider(Me.txtFName)
                SetErrorProvider(Me.txtMI)
                If (txtLName.Text) = "" And vsaved = True Then
                    SetErrorProvider(Me.txtLName, "This field is required.")
                    isValidName = False
                ElseIf (txtFName.Text) = "" And vsaved = True Then
                    SetErrorProvider(Me.txtFName, "This field is required.")
                    isValidName = False
                ElseIf (txtMI.Text) = "" And vsaved = True Then
                    SetErrorProvider(Me.txtMI, "This field is required.")
                    isValidName = False
                ElseIf dtpatient = True Then
                    If Trim(Me.txtLName.Text).Equals(Trim(mLastName), StringComparison.CurrentCultureIgnoreCase) _
                             And Trim(Me.txtFName.Text).Equals(Trim(mFName), StringComparison.CurrentCultureIgnoreCase) _
                            And Trim(Me.txtMI.Text).Equals(Trim(tempMName), StringComparison.CurrentCultureIgnoreCase) Then
                        SetErrorProvider(txtLName)
                        SetErrorProvider(txtFName)
                        SetErrorProvider(txtMI)
                        isValidName = True
                    Else
                        SetErrorProvider(Me.txtLName, "Patient name already exists in the database.")
                        SetErrorProvider(txtFName)
                        isValidName = False
                    End If
                Else
                    SetErrorProvider(txtLName)
                    SetErrorProvider(txtFName)
                    SetErrorProvider(txtMI)
                    'SetErrorProvider(txthospitalno)
                    isValidName = True
                End If
                If chkisphilhealthmember.Checked = True Then
                    If myCurrentFormStatus = enFormStatus.add Then
                        dtphilhealth = clsPatient.genericcls(30, txtPhilHealthNo.Text)
                        If Replace(txtPhilHealthNo.Text, "  -         -", "") = "" Then
                            SetErrorProvider(Me.txtPhilHealthNo, "This field is required.")
                            isValidName = False
                        ElseIf dtphilhealth.Rows(0).Item("exist") > 0 Then
                            SetErrorProvider(Me.txtPhilHealthNo, "Philhealth No. already exists.")
                            isValidName = False
                        Else
                            SetErrorProvider(txtPhilHealthNo)
                            isValidName = True
                        End If
                    ElseIf myCurrentFormStatus = enFormStatus.edit Then
                        dtphilhealth = clsPatient.genericcls(29, vpatphilhealthno, txtPhilHealthNo.Text)
                        If Replace(txtPhilHealthNo.Text, "  -         -", "") = "" Then
                            SetErrorProvider(Me.txtPhilHealthNo, "This field is required.")
                            isValidName = False
                        ElseIf dtphilhealth.Rows(0).Item("exist") > 0 Then
                            SetErrorProvider(Me.txtPhilHealthNo, "Philhealth No. already exists.")
                            isValidName = False
                        Else
                            SetErrorProvider(txtPhilHealthNo)
                            isValidName = True
                        End If
                    End If
                Else
                    If Replace(txtPhilHealthNo.Text, "  -         -", "") = "" Then
                        SetErrorProvider(Me.btnPhilHealth, "This field is required.")
                        isValidName = False
                    Else
                        SetErrorProvider(Me.btnPhilHealth)
                    End If
                End If
            End If
            Return isValidName
        End If
        Return True
    End Function
    'Private Function validatehospno(ByVal ctl As Control)
    '    Dim isValid As Boolean
    '    'hospnolen = txthospitalno.Text
    '    ''    Call Split(hospnolen)
    '    Dim dts As DataTable = clsPatient.genericcls(19, hospnolen)
    '    If dts.Rows(0).Item("isexist") = 1 Then
    '        SetErrorProvider(Me.txthospitalno, "Pt No. already exists.")
    '        isValid = False
    '    ElseIf ctl.Text = "" Then
    '        SetErrorProvider(ctl, "This field is required.")
    '        isValid = False
    '        'Else
    '        '    isValid = True
    '        '    ResPatNo(lblPatientNo)
    '        'End If
    '        Return isValid
    'End Function
#End Region

#Region "Form Events"
    Private Sub tsSaved_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tsSaved.Click
        If myCurrentFormStatus = enFormStatus.add And Trim(Me.txtMI.Text) = "" Then
            x = 0
        Else
            x = 1
        End If
        vsaved = True

        ValidateAllFields()
        If isValidName = False Then
            'Or Trim(txtLName.Text) = "" Or Trim(txtFName.Text) = "" Then
            'ValidateAllFields()
            Exit Sub
        End If
        Save()
        vsaved = False
    End Sub
    Private Sub tsClosed_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tsClosed.Click
        If myCurrentFormStatus <> enFormStatus.browsing Then
            If MsgBox("Are you sure you want to close this form?", MsgBoxStyle.Question + MsgBoxStyle.YesNo, modGlobal.msgboxTitle) = MsgBoxResult.Yes Then
                Me.Close()
                isSave = False
            End If
        Else
            Me.Close()
            isSave = True
        End If
    End Sub
    Private Sub frmPatient_KeyDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyDown
        If e.Control = True And e.KeyCode = Keys.S Then
            If isSave = False And myCurrentFormStatus <> enFormStatus.browsing Then
                If myCurrentFormStatus = enFormStatus.add And Trim(Me.txtMI.Text) = "" Then
                    x = 0
                Else
                    x = 1
                End If
                vsaved = True
                ValidateAllFields()
                If isValidName = False Then
                    'Or Trim(txtLName.Text) = "" Or Trim(txtFName.Text) = "" Then
                    ValidateAllFields()
                    Exit Sub
                End If
                Save()
                vsaved = False
            End If
        ElseIf e.KeyCode = Keys.Escape Then
            If myCurrentFormStatus <> enFormStatus.browsing Then
                If MsgBox("Are you sure you want to close this form?", MsgBoxStyle.Question + MsgBoxStyle.YesNo, modGlobal.msgboxTitle) = MsgBoxResult.Yes Then
                    Me.Close()
                End If
            Else
                Me.Close()
            End If
        ElseIf e.KeyCode = Keys.F3 Then
            selectImage(Me.pctrPhoto, "Photo")
        End If
    End Sub
    Private Sub frmPatient_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Me.Show()
        If vishospnounique > 0 Then
            Me.txtLName.Focus()
        Else
            Me.txthospitalno.Focus()
            Me.txthospitalno.SelectAll()
        End If
        Call Loadhospitalinfo()
        EnableFields()
        dtptimeofbirth.Value = " #11/16/2012 00:00:00 AM#"
        Call LoadImage()
        Call LoadtoCombobox()
        Call LoadReligions()
        Call LoadOccupations()
        Call LoadCivilStatus()
        Call fillAddress()
        BlankForm()

        If myCurrentFormStatus = enFormStatus.add Then
            LoadPtNo()
        ElseIf myCurrentFormStatus = enFormStatus.browsing Or myCurrentFormStatus = enFormStatus.edit Then
            If hasBalance Then
                Me.Timer1.Enabled = True
                'Me.lblAbsconded.Visible = True
                Me.lblBalance.Visible = True
                Me.lblBalanceLabel.Visible = True
                Me.lblBalance.Text = FormatNumber(balanceAmount, 2)
            End If
            WrapPropertiesToUI(patientid)
        End If
    End Sub
    Private Sub btnPhilHealth_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPhilHealth.Click

        Dim fSearchPhilHealthMember As New frmSearchEngine()
        fSearchPhilHealthMember.mModuleName = frmSearchEngine.ModuleName.PhilHealthMembers
        fSearchPhilHealthMember.ShowDialog()
        If fSearchPhilHealthMember.mKey = "" Then
            Exit Sub
        End If
        mPhiHealthNo = fSearchPhilHealthMember.mKey
        Call LoadPhilHealthMember(mPhiHealthNo)
    End Sub
    Private Sub chkNewBornBaby_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkNewBornBaby.CheckedChanged
        'If Me.chkNewBornBaby.Checked = True Then
        '    Dim dtshospinfo As DataTable = clsAdmissiondetails.genericcls(32)
        '    Me.txtBirthPlace.Text = dtshospinfo.Rows(0).Item("address")
        '    dtptimeofbirth.Visible = True
        '    Label37.Visible = True
        '    If myCurrentFormStatus = enFormStatus.add Then
        '        dtptimeofbirth.Value = " #11/16/2012 00:00:00 AM#"
        '    End If
        'Else
        '    dtptimeofbirth.Value = "1/1/1900 12:00:00 AM"
        '    dtptimeofbirth.Visible = False
        '    Label37.Visible = False
        '    Me.txtBirthPlace.Clear()
        'End If
    End Sub
    Private Sub btnAddPhoto_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnAddPhoto.Click
        selectImage(Me.pctrPhoto, "Photo")
    End Sub
    Private Sub pctrPhoto_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pctrPhoto.Click
        'selectImage(Me.pctrPhoto, "Photo")
        'If pctrPhoto.Image IsNot Nothing Then
        '    Dim pctre As New frmEnlargeImage()
        '    pctre.pctreenlarge.Image = Me.pctrPhoto.Image
        '    pctre.Text = Me.txtFName.Text & " '" & Me.txtMI.Text & "' " & Me.txtLName.Text & ".Image "
        '    pctre.ShowDialog()
        'End If
    End Sub
    Private Sub rbMale_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles rbMale.CheckedChanged
        Try
            If gender = "F" Then
                If myCurrentFormStatus = enFormStatus.edit Then
                    If IsDBNull(dtpatient.Rows(0).Item("photo")) = True Then
                        Me.pctrPhoto.Image = Global.HisReports.My.Resources.Resources.male
                        gender = "M"
                    End If
                Else
                    Me.pctrPhoto.Image = Global.HisReports.My.Resources.Resources.male
                    gender = "M"
                End If
            End If
        Catch ex As Exception
        End Try

    End Sub
    Private Sub rbFemale_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles rbFemale.CheckedChanged
        Try
            If gender = "M" Then
                If myCurrentFormStatus = enFormStatus.edit Then
                    If IsDBNull(dtpatient.Rows(0).Item("photo")) = True Then
                        Me.pctrPhoto.Image = Global.HisReports.My.Resources.female
                        gender = "F"
                    End If

                Else
                    Me.pctrPhoto.Image = Global.HisReports.My.Resources.female
                    gender = "F"
                End If
            End If
        Catch ex As Exception
        End Try
    End Sub
    Private Sub btnCam_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnSnapshot.Click
        'Dim fcam As New webcamapps
        'fcam.ShowDialog()
        'Call pctrbox(fcam.filePath)
    End Sub
    'Private Sub txthospitalno_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txthospitalno.TextChanged
    '    'If myCurrentFormStatus = enFormStatus.edit Then
    '    'Dim dtreval As DataTable = clsAdmissiondetails.gethospptno()
    '    'If txthospitalno.Enabled = True Then
    '    '    validatehospno(Me.txthospitalno)
    '    'End If

    '    'If hospnolen >= dtreval.Rows(0).Item("refval") Then
    '    '    Me.txthospitalno.Enabled = False
    '    '    Me.chkUpdate.Checked = False
    '    'End If

    '    If myCurrentFormStatus = enFormStatus.add And Me.txthospitalno.Text <> "" Then
    '    hospnolen = Me.txthospitalno.Text
    '    Call Split(hospnolen)
    '    End If
    'End Sub
    Private Sub chkUpdate_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkUpdate.CheckedChanged
        If chkUpdate.Checked = True Then
            Me.txthospitalno.Enabled = True
            Me.txthospitalno.Focus()
            Me.txthospitalno.SelectAll()
        Else
            Me.txthospitalno.Enabled = False
            Call LoadPtNo()
        End If
    End Sub
#End Region

#Region "General Methods"
    Private Sub WrapUIToProperties()
        'Dim fwebcams As New webcamapps
        Dim dtpatients As New DataTable
        Dim mypatient As New clsPatient

        If myCurrentFormStatus = enFormStatus.add Then
            'hospnolen = vHospitalno
            hospnolen = strip(vHospitalno)
        End If
        mypatient.HospitalNo = hospnolen
        mypatient.FName = Trim(Me.txtFName.Text)
        mypatient.LName = Trim(Me.txtLName.Text)
        mypatient.MName = Trim(Me.txtMI.Text)
        mypatient.Suffix = Trim(Me.txtSuffix.Text)
        mypatient.BirthDate = Me.DTBirthDate.Value.Date + Me.dtptimeofbirth.Value.TimeOfDay
        mypatient.isActive = Me.chkactive.Checked
        If Me.rbMale.Checked = True Then
            mypatient.Gender = "M"
            If myCurrentFormStatus = enFormStatus.edit Then
                Try
                    If IsDBNull(dtpatient.Rows(0).Item("photo")) Then
                        imageName = PatImage.Images.Keys(0)
                    End If
                Catch
                End Try
            Else
                imageName = PatImage.Images.Keys(0)
            End If
        Else
            mypatient.Gender = "F"
            If myCurrentFormStatus = enFormStatus.edit Then
                If IsDBNull(dtpatient.Rows(0).Item("photo")) Then
                    imageName = PatImage.Images.Keys(1)
                    'Else
                    '    imageName = ImageList1.Images.Keys(1)
                End If
            Else
                imageName = PatImage.Images.Keys(1)
            End If
        End If
        mypatient.CompanyName = Me.txtCompany.Text
        If IsNothing(Me.cmbcivilstatus.SelectedValue) Then
            mypatient.CivilStatus = "Single"
        Else
            mypatient.CivilStatus = Me.cmbcivilstatus.SelectedValue
        End If

        mypatient.TelephoneNo = Me.txtLandlineNo.Text
        mypatient.Address = Me.txtAddress.Text
        mypatient.BirthPlace = Me.txtBirthPlace.Text
        mypatient.GSISNo = Me.txtGSISNo.Text
        mypatient.SSSNo = Me.txtSSSNo.Text
        mypatient.BusinessAddress = Me.txtBusinessAddress.Text
        mypatient.Religion = Me.cmbReligion.SelectedValue
        mypatient.Nationality = Me.cmbNationality.SelectedValue
        mypatient.Occupation = Me.cmboccupation.SelectedValue
        mypatient.Father = Me.txtFatherName.Text
        mypatient.Mother = Me.txtMotherName.Text
        mypatient.PhilHealthNo = Me.txtPhilHealthNo.Text
        mypatient.RegisteredBy = modGlobal.employeeid

        If chkNewBornBaby.Checked = True Then
            mypatient.NewBornBaby = True
        ElseIf chkNewBornBaby.Checked = False Then
            mypatient.NewBornBaby = False
        End If

        mypatient.EmailAddress = Me.txtEmailAdd.Text
        mypatient.BloodType = Me.cmbBloodType.SelectedValue
        mypatient.MobileNo = Me.txtMobileno.Text
        mypatient.OscaIDNo = Me.txtOCAIDNo.Text
        mypatient.Age = DateDiff(DateInterval.Year, Me.DTBirthDate.Value, Utility.GetServerDate())
        mypatient.Region = Me.cmbregions.SelectedValue
        mypatient.Province = Me.cmbprovinces.SelectedValue
        mypatient.Municipality = Me.cmbmunicipality.SelectedValue
        mypatient.Barangay = Me.txtBarangay.Text
        mypatient.HouseNoStreet = Me.txthousenostreet.Text
        mypatient.isphilhealthmember = Me.chkisphilhealthmember.Checked
        Try
            Dim mstream As New MemoryStream
            pctrPhoto.Image.Save(mstream, System.Drawing.Imaging.ImageFormat.Jpeg)

            Dim myBytes(mstream.Length - 1) As Byte
            mstream.Position = 0

            mstream.Read(myBytes, 0, mstream.Length)
            mypatient.Photo = myBytes
        Catch ex As Exception
            mypatient.Photo = Nothing
        End Try
        If myCurrentFormStatus = enFormStatus.add Then
            If mypatient.isphilhealthmember Then
                Dim newPhilHealthRecord As New clsPhilHealth
                newPhilHealthRecord.PhilHealthNo = Me.txtPhilHealthNo.Text
                newPhilHealthRecord.PhilLastName = mypatient.LName
                newPhilHealthRecord.PhilFirstName = mypatient.FName
                newPhilHealthRecord.PhilMiddleName = mypatient.MName
                newPhilHealthRecord.PhilSuffix = mypatient.Suffix
                newPhilHealthRecord.PhilMembershipCatCode = IIf(mypatient.Age >= 60, 6, 0)
                newPhilHealthRecord.PhilAvailmentType = ""
                newPhilHealthRecord.PhilHouseNo = mypatient.HouseNoStreet
                newPhilHealthRecord.PhilBarangay = mypatient.Barangay
                newPhilHealthRecord.PhilCityMunicipality = Me.cmbmunicipality.Text
                newPhilHealthRecord.PhilProvince = Me.cmbprovinces.Text
                newPhilHealthRecord.PhilZipCode = Me.txtZipCode.Text
                newPhilHealthRecord.PhilDateofBirth = mypatient.BirthDate
                newPhilHealthRecord.PhilEmailAdd = Me.txtEmailAdd.Text
                newPhilHealthRecord.PhilMobileNo = Me.txtMobileno.Text
                newPhilHealthRecord.PhilLandLineNo = Me.txtLandlineNo.Text
                newPhilHealthRecord.PhilEmpNo = ""
                newPhilHealthRecord.PhilEmpContactNo = ""
                newPhilHealthRecord.PhilEmpBusName = ""
                newPhilHealthRecord.PhilEmpBldgNo = ""
                newPhilHealthRecord.PhilEmpCityMunicipality = ""
                newPhilHealthRecord.PhilEmpProvince = ""
                newPhilHealthRecord.PhilEmpZipCode = ""
                newPhilHealthRecord.unitroomnofloor = ""
                newPhilHealthRecord.buildingname = ""
                newPhilHealthRecord.lotblockhousebldngno = ""
                newPhilHealthRecord.country = ""
                newPhilHealthRecord.relationshiptomember = 0
                mypatient.relationshiptomember = "M"
                If Me.rbMale.Checked = True Then
                    newPhilHealthRecord.gender = "M"
                Else
                    newPhilHealthRecord.gender = "F"
                End If
                newPhilHealthRecord.Save(True)
            End If
            If myCurrentFormStatus = enFormStatus.add Then
                MsgBox("Record successfully saved.", vbInformation + MsgBoxStyle.OkOnly, modGlobal.msgboxTitle)
            ElseIf myCurrentFormStatus = enFormStatus.edit Then
                MsgBox("Record successfully updated.", vbInformation + MsgBoxStyle.OkOnly, modGlobal.msgboxTitle)
            End If
            patientid = mypatient.Save(True, True)
        Else
            mypatient.PatientID = patientid
            mypatient.Save(False, True)
        End If
        myCurrentFormStatus = enFormStatus.browsing
        isSave = True
        Call EnableFields()
    End Sub
    Private Sub WrapPropertiesToUI(ByRef pid As Long)

        Dim dthospitalNo As New DataTable
        dtpatient = clsPatient.PatientInfor(pid)
        If myCurrentFormStatus <> enFormStatus.add Then
            vHospitalno = Utility.NullToEmptyString(dtpatient.Rows(0).Item("HospitalNo"))
        Else
            dthospitalNo = clsAdmissiondetails.gethospptno()
        End If

        If vHospitalno = "" And chkUpdate.Checked = False Then
            vHospitalno = Utility.NullToEmptyString(dthospitalNo.Rows(0).Item("refval"))
        End If
        Call Split(vHospitalno)
        If Me.chkUpdate.Checked = True Then
            Me.txthospitalno.Text = Me.txthospitalno.Text
        Else
            Me.txthospitalno.Text = vHospitalno
        End If
        mLastName = dtpatient.Rows(0).Item("LastName")
        mFName = dtpatient.Rows(0).Item("FirstName")
        tempMName = dtpatient.Rows(0).Item("MiddleName")
        Me.txtFName.Text = mFName
        Me.txtLName.Text = mLastName
        Me.txtMI.Text = tempMName
        oldLastName = dtpatient.Rows(0).Item("LastName")
        oldFirstName = dtpatient.Rows(0).Item("FirstName")
        oldMI = dtpatient.Rows(0).Item("MiddleName")
        Me.DTBirthDate.Value = FormatDateTime(dtpatient.Rows(0).Item("BirthDate"), DateFormat.ShortDate)
        Me.dtptimeofbirth.Value = dtpatient.Rows(0).Item("BirthDate")
        gender = UCase(dtpatient.Rows(0).Item("Gender").ToString)
        If Trim(gender) = "M" Then
            rbMale.Checked = True
        Else
            rbFemale.Checked = True
        End If
        Me.txtCompany.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("Company"))
        Me.chkactive.Checked = dtpatient.Rows(0).Item("isactive")
        Me.cmbcivilstatus.SelectedValue = (dtpatient.Rows(0).Item("CivilStatus").ToString).ToUpper
        'If Trim(civilstatus) = "Single" Then
        '    rbSingle.Checked = True
        'ElseIf Trim(civilstatus) = "Married" Then
        '    rbMarried.Checked = True
        'ElseIf Trim(civilstatus) = "Widow" Then
        '    rbWiddow.Checked = True
        'End If
        Me.chkisphilhealthmember.Checked = Utility.NullToZero(dtpatient.Rows(0).Item("isphilhealthmember"))
        vpatphilhealthno = Utility.NullToEmptyString(dtpatient.Rows(0).Item("philhealthno"))
        Me.txtPhilHealthNo.Text = vpatphilhealthno
        Me.txtAddress.Text = dtpatient.Rows(0).Item("homeAddress")
        Me.txtBirthPlace.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("BirthPlace"))
        Me.txtLandlineNo.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("telephoneno"))
        Me.txtGSISNo.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("GSISNo"))
        Me.txtSSSNo.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("SSSNo"))
        Me.txtBusinessAddress.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("BusinessAddress"))
        Dim dt As DataTable = clsPatient.genericcls(21, (Utility.NullToEmptyString(dtpatient.Rows(0).Item("Religion"))))
        If dt.Rows.Count > 0 Then
            Me.cmbReligion.SelectedValue = dt.Rows(0).Item("religionid")
        Else
            If (modGlobal.hospitalname).ToUpper Like "*DOMINICAN*" Then
                Me.cmbReligion.SelectedValue = 8
            Else : Me.cmbReligion.SelectedValue = 19
            End If
        End If
        vNationality = Utility.NullToEmptyString(dtpatient.Rows(0).Item("Nationality"))

        If vNationality = "" Then
            Me.cmbNationality.SelectedValue = 49
        Else
            Me.cmbNationality.SelectedValue = vNationality
        End If

        Dim dts As DataTable = clsPatient.genericcls(22, (dtpatient.Rows(0).Item("Occupation")))
        If dts.Rows.Count > 0 Then
            Me.cmboccupation.SelectedValue = Utility.NullToEmptyString(dts.Rows(0).Item("Occupationid"))
        Else
            If (modGlobal.hospitalname).ToUpper Like "*DOMINICAN*" Then
                Me.cmboccupation.SelectedValue = 78
            Else : Me.cmboccupation.SelectedValue = 3278
            End If
        End If
        Me.txtFatherName.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("FatherName"))
        Me.txtMotherName.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("MotherName"))
        vphilhealthno = Utility.NullToEmptyString(dtpatient.Rows(0).Item("philhealthno"))
        If vphilhealthno <> "" Then
            Call LoadPhilHealthMember(vphilhealthno)
        End If
        Me.dtpRegDate.Value = Utility.NullToDefaultDateFormat(dtpatient.Rows(0).Item("RegistryDate"))
        Me.dtpRegTime.Value = Utility.NullToDefaultDateFormat(dtpatient.Rows(0).Item("RegistryDate"))
        Dim visnewborn As String = Trim(Utility.NullToZero(dtpatient.Rows(0).Item("isnewborn")))
        If Trim(visnewborn) = True Then
            chkNewBornBaby.Checked = True
        ElseIf Trim(visnewborn) = False Then
            chkNewBornBaby.Checked = False
        End If
        Me.txtEmailAdd.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("EmailAddress"))
        vBloodType = Utility.NullToEmptyString((dtpatient.Rows(0).Item("bloodtype")))
        If vBloodType = "" Then
            Me.cmbBloodType.SelectedIndex = 0
        Else
            Me.cmbBloodType.SelectedValue = Trim(vBloodType)
        End If
        Me.txtMobileno.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("Mobileno"))
        Me.txtOCAIDNo.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("OscaID"))
        Me.cmbregions.SelectedValue = Utility.NullToZero(dtpatient.Rows(0).Item("regionid"))
        Me.cmbprovinces.SelectedValue = Utility.NullToZero(dtpatient.Rows(0).Item("provinceid"))
        Me.cmbmunicipality.SelectedValue = Utility.NullToZero(dtpatient.Rows(0).Item("municipalityid"))
        Me.txtBarangay.Text = dtpatient.Rows(0).Item("barangayid")
        Me.txthousenostreet.Text = Utility.NullToEmptyString(dtpatient.Rows(0).Item("housenostreet"))

        Try
            If IsDBNull(dtpatient.Rows(0).Item("photo")) = True Then
                Try
                    If hasImage = False And gender = "M" Then
                        Me.pctrPhoto.Image = Global.HisReports.My.Resources.male
                        Me.pctrPhoto.Image.Tag = 0
                        imageName = PatImage.Images.Keys(0)
                    Else : hasImage = False And gender = "F"
                        Me.pctrPhoto.Image = Global.HisReports.My.Resources.female
                        Me.pctrPhoto.Image.Tag = 1
                        imageName = PatImage.Images.Keys(1)
                    End If
                Catch ex As Exception

                End Try
            Else
                Dim tempphoto As Byte() = dtpatient.Rows(0).Item("photo")
                If IsDBNull(dtpatient.Rows(0).Item("photo")) Or tempphoto.Length = 0 Then
                    pctrPhoto.Image = Nothing
                Else
                    pctrPhoto.Image = Utility.convertImage(dtpatient.Rows(0).Item("photo")) 'image here
                End If
            End If
        Catch ex As Exception
        End Try
    End Sub
    Public Sub Split(ByVal mHospitalNo As String)
        Try
            Dim value As String
            Dim i As Integer
            Dim lhospno As String

            hospnolen = mHospitalNo

            Dim intCounter As Integer
            Dim arrSpecialChar() As String = {"-", ".", ",", "<", ">", ":", "?", """", "/", "{", "[", "}", "]", "`", "~", "!", "@", "#", "$", "%", "^", "&", "*", "(", ")", "_", "+", "=", "|", " ", "\"}
            hospnolen = mHospitalNo
            intCounter = 0
            For i = 0 To arrSpecialChar.Length - 1

                Do Until intCounter = 29
                    mHospitalNo = Replace(hospnolen, arrSpecialChar(i), "")
                    intCounter = intCounter + 1
                    hospnolen = mHospitalNo
                Loop
                intCounter = 0
            Next

            lhospno = hospnolen.Length()
            value = hospnolen
            Dim a As Integer = 2

            For i = 0 To lhospno - 2 Step a
                value = value.Insert(i + a, "-")
                If (a = 3) = True Then
                    Exit For
                Else
                    a = a + 1
                End If
            Next
            vHospitalno = value
        Catch
            MsgBox("Please provide Hospital No.", MessageBoxIcon.Information + MessageBoxButtons.OK, modGlobal.msgboxTitle)
        End Try
    End Sub
    Private Sub LoadPhilHealthMember(ByVal vPhilHealthMemNo As String)
        Dim dtPhilHealth As DataTable = clsAdmissiondetails.GetPhilHealthMembers(vPhilHealthMemNo)
        Try
            Me.txtPhilHealthNo.Text = dtPhilHealth.Rows(0).Item("philhealthno")
            Me.txtPhilMemberName.Text = dtPhilHealth.Rows(0).Item("PhilHealthMember")
        Catch
            'MsgBox("Philhealth No. does not exist.", MessageBoxIcon.Information + MessageBoxButtons.OK, modGlobal.msgboxTitle)
        End Try
    End Sub
    Private Sub selectImage(ByVal pctr As PictureBox, ByVal fromWho As String)
        Dim dlg As New OpenFileDialog()
        dlg.Filter = "Image Files|*.jpg;*.gif;*.bmp;*.png;*.jpeg"
        Dim dlgRes As DialogResult = dlg.ShowDialog()
        If dlgRes <> DialogResult.Cancel Then
            pctr.Image = Image.FromFile(dlg.FileName)

            If fromWho = "Photo" Then
                imageName = dlg.FileName
            Else
                imageName1 = dlg.FileName
            End If
            fromWho = Nothing
            hasImage = True
            gender = ""
        End If
    End Sub
    Private Sub Save()
        Dim dtreval As DataTable = clsAdmissiondetails.gethospptno()
        Exist = False
        If myCurrentFormStatus = enFormStatus.add Then
            If MsgBox("Are you sure want to save this record?", MsgBoxStyle.Question + MsgBoxStyle.YesNo, modGlobal.msgboxTitle) = MsgBoxResult.Yes Then
                WrapUIToProperties()
                If Exist = True Then
                    Exit Sub
                End If
                MsgBox("Records successfully saved.", MessageBoxIcon.Information + MessageBoxButtons.OK, modGlobal.msgboxTitle)
            End If
        ElseIf myCurrentFormStatus = enFormStatus.edit Then
            'If hospnolen >= dtreval.Rows(0).Item("refval") Then
            '    MsgBox("Hospital No. should be less than the current number.", vbInformation + MessageBoxButtons.OK, modGlobal.msgboxTitle)
            '    Exit Sub
            'End If
            If MsgBox("Are you sure you want to update this record?", MsgBoxStyle.Question + MsgBoxStyle.YesNo, modGlobal.msgboxTitle) = MsgBoxResult.Yes Then
                WrapUIToProperties()
                If Exist = True Then
                    Exit Sub
                End If
                MsgBox("Record successfully updated.", MessageBoxIcon.Information + MessageBoxButtons.OK, modGlobal.msgboxTitle)
            End If
        End If

        If myCurrentFormStatus = enFormStatus.browsing Then
            EnableFields()
            isSave = True
        End If
    End Sub
    Private Sub fillAddress()
        faddress = txthousenostreet.Text + ", " + txtBarangay.Text + ", " + cmbmunicipality.Text + ", " + cmbprovinces.Text + ", " + cmbregions.Text
        Me.txtAddress.Text = faddress
    End Sub
    Private Sub LoadPtNo()
        dtpatient = clsAdmissiondetails.gethospptno()
        Dim dtpatientinfo As DataTable = clsPatient.PatientInfor(patientid)
        If txthospitalno.Enabled = True Then
            If vHospitalno = "" Then
                If vishospnounique = 1 Then
                    vHospitalno = Utility.NullToEmptyString(dtpatient.Rows(0).Item("refval"))
                Else
                    vHospitalno = "000000"
                End If

                Call Split(vHospitalno)
            Else
                vHospitalno = vHospitalno
            End If
        ElseIf myCurrentFormStatus = enFormStatus.edit Then
            If IsDBNull(dtpatientinfo.Rows(0).Item("hospitalno")) Then
                vHospitalno = Utility.NullToEmptyString(dtpatient.Rows(0).Item("refval"))
            Else
                vHospitalno = dtpatientinfo.Rows(0).Item("hospitalno")
            End If
            SetErrorProvider(Me.txthospitalno)
        Else
            vHospitalno = Utility.NullToEmptyString(dtpatient.Rows(0).Item("refval"))
        End If
        Me.txthospitalno.Text = vHospitalno
        If myCurrentFormStatus = enFormStatus.add Then
            Me.pctrPhoto.Image = Global.HisReports.My.Resources.Resources.male
            gender = "M"
        End If
        temphospno = vHospitalno
    End Sub
    Private Sub Loadhospitalinfo()
        Dim dthospitalinfo As DataTable = clsPatient.genericcls(20)
        vishospnoautogenerated = dthospitalinfo.Rows(0).Item("ishospnoautogenerated")
        vishospnounique = dthospitalinfo.Rows(0).Item("ishospnounique")
    End Sub
#End Region

#Region "New Methods"
    Private Sub EnableFields()
        Me.tsCancels.Visible = False
        Me.tsPrints.Visible = False
        Me.chkUpdate.Visible = False
        Me.ToolStripSeparator2.Visible = False
        Me.ToolStripSeparator3.Visible = False
        If myCurrentFormStatus = enFormStatus.browsing Then
            Me.txtLName.ReadOnly = True
            Me.txtFName.ReadOnly = True
            Me.txtMI.ReadOnly = True
            Me.cmbBloodType.Enabled = False
            Me.cmbNationality.Enabled = False
            Me.cmbReligion.Enabled = False
            Me.DTBirthDate.Enabled = False
            Me.cmboccupation.Enabled = False
            Me.txtBirthPlace.ReadOnly = True
            Me.rbFemale.Enabled = False
            Me.rbMale.Enabled = False
            'Me.rbMarried.Enabled = False
            'Me.rbWiddow.Enabled = False
            'Me.rbSingle.Enabled = False
            Me.cmbcivilstatus.Enabled = False
            Me.txtCompany.ReadOnly = True
            Me.txtAddress.ReadOnly = True
            Me.txtBusinessAddress.ReadOnly = True
            Me.txtMobileno.ReadOnly = True
            Me.txtEmailAdd.ReadOnly = True
            Me.txtLandlineNo.ReadOnly = True
            Me.txtOCAIDNo.ReadOnly = True
            Me.txtGSISNo.ReadOnly = True
            Me.txtSSSNo.ReadOnly = True
            Me.chkNewBornBaby.Enabled = False
            Me.txtMotherName.ReadOnly = True
            Me.txtFatherName.ReadOnly = True
            Me.pctrPhoto.Enabled = False
            Me.btnAddPhoto.Enabled = False
            Me.txthospitalno.ReadOnly = True
            Me.chkUpdate.Enabled = False
            Me.btnSnapshot.Enabled = False
            Me.tsCancel.Visible = False
            Me.tsPrint.Visible = False
            Me.tsSaved.Visible = False
            Me.cmbregions.Enabled = False
            Me.cmbprovinces.Enabled = False
            Me.cmbmunicipality.Enabled = False
            Me.txtBarangay.ReadOnly = False
            Me.txthousenostreet.ReadOnly = True
            Me.dtptimeofbirth.Enabled = False
            Me.chkactive.Enabled = False
            Me.ToolStripSeparator1.Visible = False
            Me.btnAddOccupation.Enabled = False
            Me.btnEditOccupation.Enabled = False
            Me.btnAddReligion.Enabled = False
            Me.btnEditReligion.Enabled = False
            Me.txtPhilHealthNo.Enabled = False
            Me.chkisphilhealthmember.Enabled = False
            Me.btnPhilHealth.Visible = False
        ElseIf myCurrentFormStatus = enFormStatus.edit Then
            Me.chkUpdate.Visible = True
            Me.chkactive.Visible = True
            Me.tsSaved.Text = "Update"
        End If
        If vishospnoautogenerated = False And myCurrentFormStatus = enFormStatus.add Then
            Me.txthospitalno.Enabled = 1
        Else
            Me.txthospitalno.Enabled = 0
        End If
        If Me.chkNewBornBaby.Checked = False Then
            'gbFamilyinformation.Visible = False
            dtptimeofbirth.Visible = False
            Label37.Visible = False
        Else
            'gbFamilyinformation.Visible = True
            dtptimeofbirth.Visible = True
            Label37.Visible = True
        End If
    End Sub
    Private Sub BlankForm()
        Me.DTBirthDate.MaxDate = Utility.GetServerDate()
        Me.cmbBloodType.Items.Add(New DictionaryEntry("Unknown", "U"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("A", "A"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("B", "B"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("O", "O"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("AB", "AB"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("A+", "A+"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("A-", "A-"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("B+", "B+"))
        Me.cmbBloodType.Items.Add(New DictionaryEntry("B-", "B-"))

        Me.cmbBloodType.DisplayMember = "Key"
        Me.cmbBloodType.ValueMember = "Value"
        Me.cmbBloodType.DataSource = Me.cmbBloodType.Items
        Me.cmbBloodType.SelectedIndex = 0
    End Sub
    Private Sub LoadtoCombobox()
        Dim vaddress As DataTable = clsAddress.GenericVerification(11)
        If vaddress.Rows.Count > 0 Then
            vregionid = vaddress.Rows(0).Item("regionid")
            vprovinceid = vaddress.Rows(0).Item("provinceid")
            vmunicipalityid = vaddress.Rows(0).Item("municipalityid")
        End If


        Me.cmbNationality.DataSource = clsPatient.getNationality()
        Me.cmbNationality.DisplayMember = "Nationality"
        Me.cmbNationality.ValueMember = "Nationalitycode"
        Me.cmbNationality.SelectedValue = 49

        Me.cmbregions.DataSource = clsPatient.getregions(14, 0)
        Me.cmbregions.DisplayMember = "regionname"
        Me.cmbregions.ValueMember = "regionid"
        Me.cmbregions.SelectedValue = vregionid

        'Me.cmbmunicipality.DataSource = clsPatient.getregions(14, 2)
        'Me.cmbmunicipality.DisplayMember = "municipalityname"
        'Me.cmbmunicipality.ValueMember = "municipalityid"

        'Me.cmbbarangay.DataSource = clsPatient.getregions(14, 3)
        'Me.cmbbarangay.DisplayMember = "barangayname"
        'Me.cmbbarangay.ValueMember = "barangayid"
    End Sub
    Private Sub LoadCivilStatus()
        Me.cmbcivilstatus.Items.Add(New DictionaryEntry("SINGLE", "SINGLE"))
        Me.cmbcivilstatus.Items.Add(New DictionaryEntry("MARRIED", "MARRIED"))
        Me.cmbcivilstatus.Items.Add(New DictionaryEntry("WIDOW", "WIDOW"))
        Me.cmbcivilstatus.Items.Add(New DictionaryEntry("WIDOWER", "WIDOWER"))
        Me.cmbcivilstatus.Items.Add(New DictionaryEntry("ANNULLED", "ANNULLED"))
        Me.cmbcivilstatus.Items.Add(New DictionaryEntry("DIVORCED", "DIVORCED"))

        Me.cmbcivilstatus.DisplayMember = "Key"
        Me.cmbcivilstatus.ValueMember = "Value"
        Me.cmbcivilstatus.DataSource = Me.cmbcivilstatus.Items
        Me.cmbcivilstatus.SelectedIndex = 0
    End Sub
    Private Sub LoadOccupations()
        Me.cmboccupation.DataSource = clsPatient.getoccupation()
        Me.cmboccupation.DisplayMember = "description"
        Me.cmboccupation.ValueMember = "occupationid"

        'If (modGlobal.hospitalname).ToUpper Like "*DOMINICAN*" Then
        '    Me.cmboccupation.SelectedValue = 78
        'Else : 
        Me.cmboccupation.SelectedValue = 3278
        'End If
    End Sub
    Private Sub LoadReligions()
        Me.cmbReligion.DataSource = clsPatient.getReligion()
        Me.cmbReligion.DisplayMember = "religion"
        Me.cmbReligion.ValueMember = "religionid"
        'If (modGlobal.hospitalname).ToUpper Like "*DOMINICAN*" Then
        '    Me.cmbReligion.SelectedValue = 8
        'Else
        Me.cmbReligion.SelectedValue = 19
        'End If
    End Sub
    Private Sub LoadImage()
        Me.tsSaved.Image = modGlobal.save_icon
        Me.tsCancels.Image = modGlobal.cancel_icon
        Me.tsPrints.Image = modGlobal.print_icon
        Me.tsClosed.Image = modGlobal.close_icon
        Me.btnAddPhoto.Image = modGlobal.folder_picture_icon
        Me.btnSnapshot.Image = modGlobal.camera_icon
        Me.btnAddOccupation.Image = modGlobal.load_item_icon
        Me.btnEditOccupation.Image = modGlobal.pencil_icon
        Me.btnAddReligion.Image = modGlobal.load_item_icon
        Me.btnEditReligion.Image = modGlobal.pencil_icon
    End Sub
    Public Function strip(ByVal des As String)
        Dim strorigFileName As String
        Dim intCounter As Integer
        Dim arrSpecialChar() As String = {"-", ".", ",", "<", ">", ":", "?", """", "/", "{", "[", "}", "]", "`", "~", "!", "@", "#", "$", "%", "^", "&", "*", "(", ")", "_", "+", "=", "|", " ", "\"}
        strorigFileName = des
        intCounter = 0
        Dim i As Integer
        For i = 0 To arrSpecialChar.Length - 1

            Do Until intCounter = 29
                des = Replace(strorigFileName, arrSpecialChar(i), "")
                intCounter = intCounter + 1
                strorigFileName = des
            Loop
            intCounter = 0
        Next
        Return strorigFileName
    End Function
    Private Sub pctrbox(Optional ByVal vphoto As String = "")
        'Dim fcam As New webcamapps
        'dlg.Filter = "Image Files|*.jpg;*.gif;*.bmp;*.png;*.jpeg"
        'dlg.FileName = vphoto
        'If dlg.FileName <> "" Then
        '    Me.pctrPhoto.Image = Image.FromFile(dlg.FileName)
        '    imageName = dlg.FileName
        '    gender = ""
        'Else
        '    Exit Sub
        'End If
    End Sub
    'Public Shared Function GetServerDate() As Date
    '    Dim strPar() As String = {"Operation"}
    '    Dim strVal() As String = {0}
    '    Dim dt As DataTable = GenericDA.ManageQuery(strPar, strVal, "spGetSystemDate", 0)
    '    Dim vServerDate As Date = CDate(dt.Rows(0).Item("serverdatetime").ToString)
    '    dt = Nothing
    '    Return vServerDate
    'End Function
#End Region

    Private Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
        'If Me.lblAbsconded.Visible = True Then
        '    Me.lblAbsconded.Visible = False
        'Else
        '    Me.lblAbsconded.Visible = True
        'End If
    End Sub
    Private Sub cmbregions_SelectedValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbregions.SelectedValueChanged
        Try
            Me.cmbprovinces.DataSource = clsPatient.getregions(15, Me.cmbregions.SelectedValue)
            Me.cmbprovinces.DisplayMember = "provincename"
            Me.cmbprovinces.ValueMember = "provinceid"
            Me.cmbprovinces.SelectedValue = vprovinceid
            If cmbregions.SelectedValue = 1 Then
                Me.cmbprovinces.DataSource = Nothing
                Me.cmbmunicipality.DataSource = Nothing
            End If
        Catch ex As Exception

        End Try
        Call fillAddress()
    End Sub
    Private Sub cmbprovinces_SelectedValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbprovinces.SelectedValueChanged
        Try
            Me.cmbmunicipality.DataSource = clsPatient.getregions(16, Me.cmbprovinces.SelectedValue)
            Me.cmbmunicipality.DisplayMember = "municipalityname"
            Me.cmbmunicipality.ValueMember = "municipalityid"
            Me.cmbmunicipality.SelectedValue = vmunicipalityid
            If cmbprovinces.SelectedValue = 1 Then
                Me.cmbmunicipality.DataSource = Nothing
            End If
        Catch ex As Exception

        End Try
        Call fillAddress()
    End Sub
    Private Sub cmbmunicipality_SelectedValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbmunicipality.SelectedValueChanged
        Call fillAddress()
    End Sub
    Private Sub txthousenostreet_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txthousenostreet.TextChanged, txtBarangay.TextChanged
        Call fillAddress()
    End Sub
    Private Sub cmboccupation_KeyUp(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cmboccupation.KeyUp
        'AutoComplete(cmboccupation, e, True)
    End Sub
    Private Sub cmbNationality_KeyUp(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cmbNationality.KeyUp
        'AutoComplete(cmbNationality, e, True)
    End Sub
    Private Sub cmbReligion_KeyUp(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cmbReligion.KeyUp
        'AutoComplete(cmbReligion, e, True)
    End Sub
    Private Sub btnAddOccupation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnAddOccupation.Click
        Dim frm As New frmSubOccupation_Religion_Nationality(frmSubOccupation_Religion_Nationality.enFormStatus.add, 0)
        frm.oldid = Me.cmboccupation.SelectedValue
        frm.ShowDialog()
        If frm.isSave Then
            Call LoadOccupations()
            Me.cmboccupation.SelectedValue = frm.oldid
        End If
        frm = Nothing
    End Sub
    Private Sub btnEditOccupation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnEditOccupation.Click
        Dim frm As New frmSubOccupation_Religion_Nationality(frmSubOccupation_Religion_Nationality.enFormStatus.edit, 0)
        frm.oldid = Me.cmboccupation.SelectedValue
        frm.ShowDialog()
        If frm.isSave Then
            Call LoadOccupations()
            Me.cmboccupation.SelectedValue = frm.oldid
        End If
        frm = Nothing
    End Sub
    Private Sub btnAddReligion_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnAddReligion.Click
        Dim frm As New frmSubOccupation_Religion_Nationality(frmSubOccupation_Religion_Nationality.enFormStatus.add, 1)
        frm.oldid = Me.cmbReligion.SelectedValue
        frm.ShowDialog()
        If frm.isSave Then
            Call LoadReligions()
            Me.cmbReligion.SelectedValue = frm.oldid
        End If
        frm = Nothing
    End Sub
    Private Sub btnEditReligion_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnEditReligion.Click
        Dim frm As New frmSubOccupation_Religion_Nationality(frmSubOccupation_Religion_Nationality.enFormStatus.edit, 1)
        frm.oldid = Me.cmbReligion.SelectedValue
        frm.ShowDialog()
        If frm.isSave Then
            Call LoadReligions()
            Me.cmbReligion.SelectedValue = frm.oldid
        End If
        frm = Nothing
    End Sub
    Private Sub cmbcivilstatus_KeyUp(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cmbcivilstatus.KeyUp
        'AutoComplete(cmbcivilstatus, e, True)
    End Sub

    Private Sub chkisphilhealthmember_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkisphilhealthmember.CheckedChanged
        If Me.chkisphilhealthmember.Checked = True Then
            'Label241.Visible = True
            txtPhilHealthNo.Text = vphilhealthno
            txtPhilHealthNo.Enabled = True
        Else
            SetErrorProvider(Me.txtPhilHealthNo)
            txtPhilHealthNo.Text = ""
            Me.txtPhilMemberName.Text = "--,-"
            txtPhilHealthNo.Enabled = False
        End If
        Me.lblmembername.Visible = Not Me.chkisphilhealthmember.Checked
        Me.txtPhilMemberName.Visible = Not Me.chkisphilhealthmember.Checked
        Me.btnPhilHealth.Visible = Not Me.chkisphilhealthmember.Checked
    End Sub

End Class